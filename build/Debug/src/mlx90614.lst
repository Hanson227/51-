C51 COMPILER V9.54   MLX90614                                                              03/09/2022 21:53:20 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MLX90614
OBJECT MODULE PLACED IN .\build\Debug\src\mlx90614.o
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.exe .\SRC\MLX90614.C PRINT(.\build\Debug\src\mlx90614.lst) OMF2 TABS(4) CODE N
                    -OCOND SYMBOLS OPTIMIZE(8,SPEED) SMALL ROM(LARGE) INCDIR(d:\Keil5\C51\INC\Atmel;D:\Keil5\C51\INC;.\src) DEFINE(__UVISION_
                    -VERSION=526) OBJECT(.\build\Debug\src\mlx90614.o)

line level    source

   1          #include <REGX52.H>
   2          
   3          sbit SCL=P2^1;
   4          sbit SDA=P2^0;
   5          
   6          
   7          #define Nack_counter 1
   8          
   9          //************数据定义****************
  10          
  11          unsigned char bit_out=1;
  12          unsigned char bit_in=1;
  13          
  14          unsigned char DataH,DataL,Pecreg;
  15          
  16          void start_bit(void)
  17          {
  18   1              SDA=1;
  19   1              _nop_();_nop_();_nop_();_nop_();_nop_();
*** WARNING C206 IN LINE 19 OF .\SRC\MLX90614.C: '_nop_': missing function-prototype
*** ERROR C264 IN LINE 19 OF .\SRC\MLX90614.C: intrinsic '_nop_': declaration/activation error
  20   1              SCL=1;
  21   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  22   1              SDA=0;
  23   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  24   1              SCL=0;
  25   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  26   1      }
  27          
  28          void stop_bit(void)
  29          {
  30   1              SCL=0;
  31   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  32   1              SDA=0;
  33   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  34   1              SCL=1;
  35   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  36   1              SDA=1;
  37   1      }
  38          
  39          
  40          //---------发送一个字节---------
  41          void tx_byte(unsigned char dat_byte)
  42          {
  43   1              char i,n,dat;
  44   1              n=Nack_counter;
  45   1      
  46   1              dat=dat_byte;
  47   1              for(i=0;i<8;i++)
  48   1              {
  49   2                      if(dat&0x80)
  50   2                      bit_out=1;
  51   2                      else
C51 COMPILER V9.54   MLX90614                                                              03/09/2022 21:53:20 PAGE 2   

  52   2                      bit_out=0;
  53   2                      send_bit();
  54   2                      dat=dat<<1;
  55   2              }
  56   1              receive_bit();
  57   1              if(bit_in==1)
  58   1              {
  59   2                      stop_bit();
  60   2                      if(n!=0)
  61   2                      {n--;}
  62   2                      else
  63   2                              return;
  64   2              }
  65   1              else
  66   1                      return;
  67   1              start_bit();
  68   1              tx_byte(dat_byte);                //函数自身回调
  69   1      }
  70          
  71          //-----------发送一个位---------
  72          void send_bit(void)
  73          {
  74   1              if(bit_out==0)
  75   1                      SDA=0;
  76   1              else
  77   1                      SDA=1;
  78   1              _nop_();
  79   1              SCL=1;
  80   1              _nop_();_nop_();_nop_();_nop_();
  81   1              _nop_();_nop_();_nop_();_nop_();
  82   1              SCL=0;
  83   1              _nop_();_nop_();_nop_();_nop_();
  84   1              _nop_();_nop_();_nop_();_nop_();
  85   1      }
  86          //----------接收一个字节--------
  87          unsigned char rx_byte(void)
  88          {
  89   1              unsigned char i,dat;
  90   1              dat=0;
  91   1              for(i=0;i<8;i++)
  92   1              {
  93   2                      dat=dat<<1;
  94   2                      receive_bit();
  95   2                      if(bit_in==1)
  96   2                      dat=dat+1;
  97   2              }
  98   1              send_bit();
  99   1              return dat;
 100   1      }
 101          //----------接收一个位----------
 102          void receive_bit(void)
 103          {
 104   1              SDA=1;bit_in=1;
 105   1              SCL=1;
 106   1              _nop_();_nop_();_nop_();_nop_();
 107   1              _nop_();_nop_();_nop_();_nop_();
 108   1              bit_in=SDA;
 109   1              _nop_();
 110   1              SCL=0;
 111   1              _nop_();_nop_();_nop_();_nop_();
 112   1              _nop_();_nop_();_nop_();_nop_();
 113   1      }
C51 COMPILER V9.54   MLX90614                                                              03/09/2022 21:53:20 PAGE 3   

 114          
 115          //------------------------------
 116          unsigned int ReadObjectTemp(void)
 117          {
 118   1              start_bit();
 119   1              tx_byte(0x00); //Send SlaveAddress
 120   1              tx_byte(0x07); //Send Command
 121   1              start_bit();
 122   1              tx_byte(0x01);
 123   1              bit_out=0;
 124   1              DataL=rx_byte();
 125   1              bit_out=0;
 126   1              DataH=rx_byte();
 127   1              bit_out=1;
 128   1              Pecreg=rx_byte();
 129   1              stop_bit();
 130   1              return(DataH*256+DataL);
 131   1      }
 132          
 133          unsigned int ReadEnvironTemp(void)
 134          {
 135   1              start_bit();
 136   1              tx_byte(0x00); //Send SlaveAddress
 137   1              tx_byte(0x06); //Send Command
 138   1              start_bit();
 139   1              tx_byte(0x01);
 140   1              bit_out=0;
 141   1              DataL=rx_byte();
 142   1              bit_out=0;
 143   1              DataH=rx_byte();
 144   1              bit_out=1;
 145   1              Pecreg=rx_byte();
 146   1              stop_bit();
 147   1              return(DataH*256+DataL);
 148   1      }
 149          

C51 COMPILATION COMPLETE.  1 WARNING(S),  1 ERROR(S)
