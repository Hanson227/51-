C51 COMPILER V9.54   MLX90614                                                              03/09/2022 21:56:32 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MLX90614
OBJECT MODULE PLACED IN .\build\Debug\src\mlx90614.o
COMPILER INVOKED BY: D:\Keil5\C51\BIN\C51.exe .\SRC\MLX90614.C PRINT(.\build\Debug\src\mlx90614.lst) OMF2 TABS(4) CODE N
                    -OCOND SYMBOLS OPTIMIZE(8,SPEED) SMALL ROM(LARGE) INCDIR(d:\Keil5\C51\INC\Atmel;D:\Keil5\C51\INC;.\src) DEFINE(__UVISION_
                    -VERSION=526) OBJECT(.\build\Debug\src\mlx90614.o)

line level    source

   1          #include <REGX52.H>
   2          #include <intrins.h>
   3          
   4          sbit SCL=P2^1;
   5          sbit SDA=P2^0;
   6          
   7          
   8          #define Nack_counter 1
   9          
  10          //************数据定义****************
  11          
  12          unsigned char bit_out=1;
  13          unsigned char bit_in=1;
  14          
  15          unsigned char DataH,DataL,Pecreg;
  16          
  17          void start_bit(void)
  18          {
  19   1              SDA=1;
  20   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  21   1              SCL=1;
  22   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  23   1              SDA=0;
  24   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  25   1              SCL=0;
  26   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  27   1      }
  28          
  29          void stop_bit(void)
  30          {
  31   1              SCL=0;
  32   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  33   1              SDA=0;
  34   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  35   1              SCL=1;
  36   1              _nop_();_nop_();_nop_();_nop_();_nop_();
  37   1              SDA=1;
  38   1      }
  39          
  40          
  41          //---------发送一个字节---------
  42          void tx_byte(unsigned char dat_byte)
  43          {
  44   1              char i,n,dat;
  45   1              n=Nack_counter;
  46   1      
  47   1              dat=dat_byte;
  48   1              for(i=0;i<8;i++)
  49   1              {
  50   2                      if(dat&0x80)
  51   2                      bit_out=1;
  52   2                      else
  53   2                      bit_out=0;
C51 COMPILER V9.54   MLX90614                                                              03/09/2022 21:56:32 PAGE 2   

  54   2                      send_bit();
*** WARNING C206 IN LINE 54 OF .\SRC\MLX90614.C: 'send_bit': missing function-prototype
  55   2                      dat=dat<<1;
  56   2              }
  57   1              receive_bit();
*** WARNING C206 IN LINE 57 OF .\SRC\MLX90614.C: 'receive_bit': missing function-prototype
  58   1              if(bit_in==1)
  59   1              {
  60   2                      stop_bit();
  61   2                      if(n!=0)
  62   2                      {
  63   3                         n--;   
  64   3                      }
  65   2                      else
  66   2                              return;
  67   2              }
  68   1              else
  69   1                      return;
  70   1              start_bit();
  71   1              tx_byte(dat_byte);                //函数自身回调
*** WARNING C265 IN LINE 71 OF .\SRC\MLX90614.C: '_tx_byte': recursive call to non-reentrant function
  72   1      }
  73          
  74          //-----------发送一个位---------
  75          void send_bit(void)
  76          {
*** ERROR C231 IN LINE 76 OF .\SRC\MLX90614.C: 'send_bit': redefinition
  77   1              if(bit_out==0)
  78   1                      SDA=0;
  79   1              else
  80   1                      SDA=1;
  81   1              _nop_();
  82   1              SCL=1;
  83   1              _nop_();_nop_();_nop_();_nop_();
  84   1              _nop_();_nop_();_nop_();_nop_();
  85   1              SCL=0;
  86   1              _nop_();_nop_();_nop_();_nop_();
  87   1              _nop_();_nop_();_nop_();_nop_();
  88   1      }
*** ERROR C231 IN LINE 88 OF .\SRC\MLX90614.C: 'send_bit': redefinition
  89          //----------接收一个字节--------
  90          unsigned char rx_byte(void)
  91          {
  92   1              unsigned char i,dat;
  93   1              dat=0;
  94   1              for(i=0;i<8;i++)
  95   1              {
  96   2                      dat=dat<<1;
  97   2                      receive_bit();
  98   2                      if(bit_in==1)
  99   2                      dat=dat+1;
 100   2              }
 101   1              send_bit();
 102   1              return dat;
 103   1      }
 104          //----------接收一个位----------
 105          void receive_bit(void)
 106          {
*** ERROR C231 IN LINE 106 OF .\SRC\MLX90614.C: 'receive_bit': redefinition
 107   1              SDA=1;bit_in=1;
 108   1              SCL=1;
 109   1              _nop_();_nop_();_nop_();_nop_();
C51 COMPILER V9.54   MLX90614                                                              03/09/2022 21:56:32 PAGE 3   

 110   1              _nop_();_nop_();_nop_();_nop_();
 111   1              bit_in=SDA;
 112   1              _nop_();
 113   1              SCL=0;
 114   1              _nop_();_nop_();_nop_();_nop_();
 115   1              _nop_();_nop_();_nop_();_nop_();
 116   1      }
*** ERROR C231 IN LINE 116 OF .\SRC\MLX90614.C: 'receive_bit': redefinition
 117          
 118          //------------------------------
 119          unsigned int ReadObjectTemp(void)
 120          {
 121   1              start_bit();
 122   1              tx_byte(0x00); //Send SlaveAddress
 123   1              tx_byte(0x07); //Send Command
 124   1              start_bit();
 125   1              tx_byte(0x01);
 126   1              bit_out=0;
 127   1              DataL=rx_byte();
 128   1              bit_out=0;
 129   1              DataH=rx_byte();
 130   1              bit_out=1;
 131   1              Pecreg=rx_byte();
 132   1              stop_bit();
 133   1              return(DataH*256+DataL);
 134   1      }
 135          
 136          unsigned int ReadEnvironTemp(void)
 137          {
 138   1              start_bit();
 139   1              tx_byte(0x00); //Send SlaveAddress
 140   1              tx_byte(0x06); //Send Command
 141   1              start_bit();
 142   1              tx_byte(0x01);
 143   1              bit_out=0;
 144   1              DataL=rx_byte();
 145   1              bit_out=0;
 146   1              DataH=rx_byte();
 147   1              bit_out=1;
 148   1              Pecreg=rx_byte();
 149   1              stop_bit();
 150   1              return(DataH*256+DataL);
 151   1      }
 152          

C51 COMPILATION COMPLETE.  3 WARNING(S),  4 ERROR(S)
